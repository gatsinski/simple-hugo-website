---
title: "Моделът SMTP - модел клиент-сървър."
name: "client-server-model"
date: 2017-12-14T21:37:11+02:00
draft: false
order: 2
---

SMTP получателят стартира услугата, очаквайки установяване на връзка на порт 25. При наличие на заявка за изпращане на писмо, SMTP изпращачът установява TCP връзка със SMTP получателя. В последствие SMTP изпращачът и получателят обменят команди и отговори, дакато връзката не бъде прекратена. Крайната цел е писмото да бъде прехвърлено от файловата сисема на изпращача към файловата система на получателя.

<div class="centered-text">
    <img width="500px" alt="Моделът клиент сървър" src="/simple-hugo-website/images/smtp-model.png">
</div>

Възможно е връзката между получателят и изпращачът да не бъде директна и за предаване на съобщението да се използват множество междинни SMTP възли, които да го препращат, докато то достигне крайната си дестинация.

<div class="centered-text">
    <img width="500px" alt="Моделът клиент сървър при препращане между възли" src="/simple-hugo-website/images/smtp-model-step-by-step.png">
</div>


С цел определяне на маршрута на писмото и на евентуалния отговор за грешка, SMTP протоколът определя и поддържа актуални във всеки момент следните пътища:

- **прав път** - указва маршрута на писмото от SMTP изпращача до пощенската кутия на получателя на писмото.
- **обратен път** - указва маршрута на евентуален отговор за грешка от SMTP получателя до пощенската кутия на подателя на писмото.


Пътят се описва във вида:
    **@AAA,@BBB,@CCC, ...:HRISTO@DDD**, където **AAA**, **BBB**, **CCC** и **DDD** са имената на пощенските сървъри по маршрута, а **HRISTO** е име на пощенска кутия.

По време на обмена между два SMTP сървъра:

- първият адрес в правия път трябва да е винаги този на SMTP получателя.
- първият адрес в обратния път трябва да е винаги този на SMTP изпращача.

При тази концепция, по време на преминаването на писмото през междинните SMTP сървъри, всеки от тях премахва своя адрес от правия път и го добавя в обратния. Така постепенно елементите от правия път се преместват в обратния път.

<div class="centered-text">
    <img width="600px" alt="Моделът клиент сървър при изпращане между възли с показани пътища" src="/simple-hugo-website/images/smtp-model-step-by-step-with-paths.png">
</div>

По време на своето съществуване SMTP сесията преминава през няколко състояния.

<div class="centered-text">
    <img width="400px" alt="Възможни състояния на SMTP комуникацията" src="/simple-hugo-website/images/smtp-states-full.png">
</div>

<img width="400px" align="right" alt="Възможни състояния на SMTP комуникацията" src="/simple-hugo-website/images/smtp-states.png">

- след като TCP връзката е установина и SMTP получателят е изпратил приветстващо съобщение, сесията влиза в състояне "Одобрение" (AUTHORIZATION).
- в това състояние SMTP изращачът трябва да се представи на SMTP получателя.
- след представянето на SMTP изпращача, сесията преминава в състояние "Изчакване" (WAITING).
- в това състояние SMTP изпращачът може да стартира изпращане на писмо към SMTP получателя.
- в състояние "Трансакция" (TRANSACTION) се изпраща едно писмо, след което се осъществява връщане в състояние "Изчакване".
- прекратяването на сесията започва по инициатива на SMTP изпращача чрез команда QUIT, която води до прекъсване на TCP връзката.

Командите HELO, MAIL, RCPT, RSET, SEND, SOML, SAML, VRFY, EXPN, HELP, NOOP, QUIT и TURN. имат три възможни изхода - Успех, Неуспех и Грешка.

